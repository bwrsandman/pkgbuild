# Maintainer: shua <shualloret @ gmail . com>
pkgname=ogitor-hg
pkgver=20130226
pkgrel=1
pkgdesc="scene editing framework for Ogre3D"
arch=('i686' 'x86_64')
url='http://www.ogitor.org'
license=('LGPL')
depends=('ogre' 'qt')
makedepends=('cmake' 'mercurial' 'unzip')
conflicts=('ogitor')
provides=('ogitor')
source=(https://bitbucket.org/jacmoe/ogitor/downloads/media.zip
        https://bitbucket.org/jacmoe/ogitor/downloads/projects.zip)
md5sums=('c43578ed01e383a0eebd0719ae4241f8'
         'ec3e5c8026d0582ab874beac182b6be4')

_hgtrunk="https://bitbucket.org/jacmoe/ogitor"
_hgmod="ogitor"

build() {
  cd ${srcdir}

  if [ -d $_hgmod/.hg ]; then
    cd $_hgmod && hg pull -u || return 1
  else
    hg clone $_hgtrunk $_hgmod || return 1
  fi

  msg "Mercurial checkout done or server timeout"
  msg "Starting make..."

  cd ${srcdir}
  if [ -d $_hgmod-build ]; then
	  rm -rf $_hgmod-build
  fi
  hg clone $_hgmod $_hgmod-build
  cd $_hgmod-build

  unzip -d RunPath ${srcdir}/media.zip
  unzip -d RunPath ${srcdir}/projects.zip

  cmake . -DCMAKE_INSTALL_PREFIX=/usr
  make || return 1
  make DESTDIR=${pkgdir} install || return 1

  rm -rf ${srcdir}/$_hgmod-build
}
